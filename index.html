<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>OoNooBet - Crash Game</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; text-align:center; }
    h1 { margin-top:30px; }
    #loginBox, #gameBox { margin-top:40px; }
    #balanceBox { margin:20px; font-size:20px; }
    #addPointsBtn {
      margin-left:10px; padding:3px 8px; background:#0a84ff; color:#fff;
      border:none; border-radius:5px; cursor:pointer;
    }
    #multiplier { font-size:50px; margin:20px; }
    input { padding:8px; border-radius:5px; border:none; margin:10px; }
    button {
      padding:10px 20px; margin:10px; border:none; border-radius:5px;
      background:#0a84ff; color:white; cursor:pointer;
    }
    button:hover { background:#0066cc; }
    #result { margin-top:20px; font-size:18px; }
    #leaderboard {
      margin-top:40px; background:#222; padding:20px; border-radius:10px;
      max-width:400px; margin-left:auto; margin-right:auto;
    }
    #leaderboard h2 { margin-bottom:15px; }
    #leaderboard ul { list-style:none; padding:0; }
    #leaderboard li {
      background:#333; padding:8px; margin:5px 0; border-radius:5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ”¥ OoNooBet - Crash Game ğŸ”¥</h1>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginBox">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="username" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ø§Ù„Ù„Ø¹Ø¨Ø© -->
  <div id="gameBox" style="display:none;">
    <div id="balanceBox">
      <span id="balance">Ø±ØµÙŠØ¯Ùƒ: 0</span>
      <button id="addPointsBtn">+</button>
    </div>

    <div id="game">
      <div id="multiplier">x1.00</div>
      <input id="bet" type="number" value="10" min="1"> Ù†Ù‚Ø§Ø·<br>
      <button id="startBtn">Ø§Ø¨Ø¯Ø£</button>
      <button id="cashoutBtn" disabled>Ø§Ø³Ø­Ø¨</button>
      <div id="result"></div>
    </div>

    <div id="leaderboard">
      <h2>ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
      <ul id="players"></ul>
    </div>
  </div>

<script>
let balance = 0;
let gameInterval = null;
let multiplier = 1.0;
let crashPoint = 0;
let playing = false;
let username = null;

// ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API Ø¨ØªØ§Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ± Flask
const API_URL = "http://127.0.0.1:5000"; // ØºÙŠÙ‘Ø±Ù‡ Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù„ÙŠ Ù‡ØªØ±ÙØ¹ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¨Ø§Ùƒ-Ø¥Ù†Ø¯

// Ø¬Ù„Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
async function fetchBalance() {
  const res = await fetch(`${API_URL}/balance?user=${username}`);
  const data = await res.json();
  balance = data.balance;
  document.getElementById("balance").innerText = "Ø±ØµÙŠØ¯Ùƒ: " + balance;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø­Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù„Ø¹Ø¨Ø©
async function updateBalanceLocally(amount) {
  balance += amount;
  document.getElementById("balance").innerText = "Ø±ØµÙŠØ¯Ùƒ: " + balance;

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù„Ø³ÙŠØ±ÙØ±
  await fetch(`${API_URL}/update`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username: username, amount: amount })
  });
}

// Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
function startGame() {
  let bet = parseInt(document.getElementById("bet").value);
  if (balance <= 0) {
    alert("âš ï¸ Ù„Ø§Ø²Ù… ØªØ·Ù„Ø¨ Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø£ÙˆÙ„");
    return;
  }
  if (bet > balance || bet <= 0) {
    alert("âš ï¸ Ø±ØµÙŠØ¯Ùƒ Ù…Ø´ ÙƒØ§ÙÙŠ Ø£Ùˆ Ø§Ù„Ø±Ù‡Ø§Ù† ØºÙŠØ± ØµØ­ÙŠØ­");
    return;
  }

  playing = true;
  multiplier = 1.0;
  crashPoint = (Math.random() * 4 + 1.3).toFixed(2);
  document.getElementById("result").innerText = "";
  document.getElementById("cashoutBtn").disabled = false;

  // Ø®ØµÙ… Ø§Ù„Ø±Ù‡Ø§Ù† Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯
  updateBalanceLocally(-bet);

  gameInterval = setInterval(() => {
    multiplier = (parseFloat(multiplier) + 0.1).toFixed(2);
    document.getElementById("multiplier").innerText = "x" + multiplier;

    if (parseFloat(multiplier) >= crashPoint) {
      clearInterval(gameInterval);
      playing = false;
      document.getElementById("result").innerText =
        "âŒ ÙƒØ±Ø§Ø´ Ø¹Ù†Ø¯ x" + crashPoint + " - Ø®Ø³Ø±Øª";
      document.getElementById("cashoutBtn").disabled = true;
    }
  }, 500);
}

// Ø§Ù„Ø³Ø­Ø¨
function cashOut() {
  if (!playing) return;
  clearInterval(gameInterval);
  playing = false;

  let bet = parseInt(document.getElementById("bet").value);
  let win = Math.floor(bet * multiplier);

  updateBalanceLocally(win);

  document.getElementById("result").innerText =
    "âœ… Ø³Ø­Ø¨Øª Ø¹Ù†Ø¯ x" + multiplier + " - ÙƒØ³Ø¨Øª " + win;
  document.getElementById("cashoutBtn").disabled = true;
}

// Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø¯Ù…Ù†
document.getElementById("addPointsBtn").onclick = () => {
  window.open("https://t.me/OoNooBet", "_blank");
};

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById("loginBtn").onclick = async () => {
  const inputName = document.getElementById("username").value.trim();
  if (!inputName) {
    alert("âš ï¸ Ù„Ø§Ø²Ù… ØªÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
    return;
  }
  username = inputName;

  document.getElementById("loginBox").style.display = "none";
  document.getElementById("gameBox").style.display = "block";

  await fetchBalance();
  loadLeaderboard();
};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨ (Ù…Ø¤Ù‚Øª)
async function loadLeaderboard() {
  const players = document.getElementById("players");
  players.innerHTML = `
    <li>${username} - ${balance} Ù†Ù‚Ø·Ø©</li>
    <li>Ahmed - 250 Ù†Ù‚Ø·Ø©</li>
    <li>Ali - 180 Ù†Ù‚Ø·Ø©</li>
    <li>Mohamed - 120 Ù†Ù‚Ø·Ø©</li>
  `;
}

document.getElementById("startBtn").onclick = startGame;
document.getElementById("cashoutBtn").onclick = cashOut;
</script>
</body>
</html>
